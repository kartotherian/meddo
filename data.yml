_prefs:
  disabled: []
  inspector: false
  mapid: ''
  rev: ''
  saveCenter: false
name: Meddo
description: Vector tiles for Wikipedia
attribution: 'Data Â© OpenStreetMap contributors'
center:
  - 0
  - 0
  - 4
minzoom: 0
maxzoom: 16
_parts:
  # Extents are used for tilemill, and don't actually make it to the generated XML
  extents: &extents
    extent: -20037508,-20037508,20037508,20037508
    srs-name: "3857"
    srs: "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over"
  osm2pgsql: &osm2pgsql
    type: postgis
    dbname: "ct"
    srid: 3857
    geometry_field: "way"
    extent: "-20037508,-20037508,20037508,20037508"
Layer:
  - id: water
    geometry: polygon
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
            way
          FROM water_areas
          WHERE way_area > 0.01*!pixel_width!::real*!pixel_height!::real
        UNION ALL
        SELECT
            geom AS way
          FROM ocean_polygons
        ) AS water
  - id: building
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
            way
          FROM buildings
          WHERE way_area > 0.01*!pixel_width!::real*!pixel_height!::real
          ORDER BY way_area
        ) AS building
    properties:
      minzoom: 12
  - id: transport
    Datasource:
      <<: *osm2pgsql
      table: |-
        (SELECT
            way,
            class::text,
            ramp,
            oneway,
            brunnel::text,
            layer
          FROM (
            SELECT
                CASE WHEN oneway = 'reverse' THEN ST_Reverse(way) ELSE way END AS way,
                class,
                ramp,
                oneway IN ('true','reverse') AS oneway,
                brunnel,
                layer,
                NULL::real AS way_area
              FROM roads
              WHERE way && !bbox!
            UNION ALL
            SELECT
                way,
                class,
                NULL::boolean AS ramp, -- cover ssy
                NULL::boolean AS oneway,
                brunnel,
                layer,
                NULL::real AS way_area
              FROM rail
              WHERE way && !bbox!
            UNION ALL
            SELECT
                way,
                class,
                NULL::boolean AS ramp,
                NULL::boolean AS oneway,
                brunnel,
                layer,
                way_area
              FROM road_areas
              WHERE way && !bbox!
              ) AS t
          ORDER BY layer, ramp DESC, class, way_area DESC NULLS LAST
        ) AS transport
    properties:
      minzoom: 5
